/// <reference types="vite/client" />
/// <reference types="@ztools-center/ztools-api-types" />

declare module '*.vue' {
  import type { DefineComponent } from 'vue'
  const component: DefineComponent<Record<string, never>, Record<string, never>, unknown>
  export default component
}

// Preload services 类型声明（对应 public/preload/services.js）
interface Services {
  readFile: (file: string) => string
  writeTextFile: (text: string) => string
  writeImageFile: (base64Url: string) => string | undefined
}

declare global {
  interface Window {
    services: Services
    ztools: {
      // 获取拖放文件的路径（Electron webUtils）
      getPathForFile: (file: File) => string

      internal: {
        // 数据库操作（主程序专用，直接操作 ZTOOLS 命名空间）
        dbPut: (key: string, data: any) => Promise<any>
        dbGet: (key: string) => Promise<any>

        // 插件管理
        getPlugins: () => Promise<
          Array<{
            name: string
            path: string
            version: string
            description?: string
            logo?: string
            features?: any[]
            isDevelopment?: boolean
          }>
        >
        getAllPlugins: () => Promise<
          Array<{
            name: string
            path: string
            version: string
            description?: string
            logo?: string
            features?: any[]
            isDevelopment?: boolean
          }>
        >
        getRunningPlugins: () => Promise<string[]>
        importPlugin: () => Promise<{ success: boolean; error?: string }>
        importDevPlugin: () => Promise<{ success: boolean; error?: string }>
        deletePlugin: (pluginPath: string) => Promise<{ success: boolean; error?: string }>
        killPlugin: (pluginPath: string) => Promise<{ success: boolean; error?: string }>
        reloadPlugin: (pluginPath: string) => Promise<{ success: boolean; error?: string }>
        revealInFinder: (filePath: string) => Promise<void>
        launch: (options: {
          path: string
          type?: 'direct' | 'plugin'
          featureCode?: string
          param?: any
          name?: string
        }) => Promise<{ success: boolean; error?: string }>

        // 插件市场
        fetchPluginMarket: () => Promise<{ success: boolean; data?: any; error?: string }>
        installPluginFromMarket: (plugin: any) => Promise<{
          success: boolean
          error?: string
          plugin?: any
        }>

        // 插件数据管理
        getPluginReadme: (pluginPath: string) => Promise<{
          success: boolean
          content?: string
          error?: string
        }>
        getPluginDocKeys: (pluginName: string) => Promise<{
          success: boolean
          data?: Array<{ key: string; type: 'document' | 'attachment' }>
          error?: string
        }>
        getPluginDoc: (
          pluginName: string,
          key: string
        ) => Promise<{
          success: boolean
          data?: any
          type?: 'document' | 'attachment'
          error?: string
        }>
        getPluginDataStats: () => Promise<{
          success: boolean
          data?: Array<{
            pluginName: string
            docCount: number
            attachmentCount: number
            logo: string | null
          }>
          error?: string
        }>
        clearPluginData: (pluginName: string) => Promise<{
          success: boolean
          deletedCount?: number
          error?: string
        }>

        // 快捷键相关
        startHotkeyRecording: () => Promise<{ success: boolean; error?: string }>
        updateShortcut: (shortcut: string) => Promise<{ success: boolean; error?: string }>
        getCurrentShortcut: () => Promise<string>
        registerGlobalShortcut: (
          shortcut: string,
          target: string
        ) => Promise<{ success: boolean; error?: string }>
        unregisterGlobalShortcut: (shortcut: string) => Promise<{
          success: boolean
          error?: string
        }>
        onHotkeyRecorded: (callback: (shortcut: string) => void) => void

        // 窗口和设置
        setWindowOpacity: (opacity: number) => Promise<void>
        setWindowMaterial: (material: 'mica' | 'acrylic' | 'none') => Promise<{ success: boolean }>
        getWindowMaterial: () => Promise<'mica' | 'acrylic' | 'none'>
        onUpdateWindowMaterial: (callback: (material: 'mica' | 'acrylic' | 'none') => void) => void
        updateAcrylicOpacity: (lightOpacity: number, darkOpacity: number) => Promise<void>
        updatePlaceholder: (placeholder: string) => Promise<void>
        selectAvatar: () => Promise<{ success: boolean; path?: string; error?: string }>
        updateAvatar: (avatar: string) => Promise<void>
        updateAutoPaste: (autoPaste: string) => Promise<void>
        updateAutoClear: (autoClear: string) => Promise<void>
        updateAutoBackToSearch: (autoBackToSearch: string) => Promise<void>
        updateShowRecentInSearch: (showRecentInSearch: boolean) => Promise<void>
        updateRecentRows: (rows: number) => Promise<void>
        updatePinnedRows: (rows: number) => Promise<void>
        setTheme: (theme: string) => Promise<void>
        updatePrimaryColor: (primaryColor: string, customColor?: string) => Promise<void>
        setTrayIconVisible: (visible: boolean) => Promise<void>
        setLaunchAtLogin: (enable: boolean) => Promise<void>
        getLaunchAtLogin: () => Promise<boolean>
        setProxyConfig: (config: { enabled: boolean; url: string }) => Promise<{
          success: boolean
          error?: string
        }>

        // 系统信息
        getAppVersion: () => Promise<string>
        getAppName: () => Promise<string>
        getSystemVersions: () => Promise<NodeJS.ProcessVersions>
        getPlatform: () => NodeJS.Platform
        isWindows11: () => Promise<boolean>

        // 软件更新
        updaterCheckUpdate: () => Promise<{
          hasUpdate: boolean
          latestVersion?: string
          updateInfo?: any
          error?: string
        }>
        updaterStartUpdate: (updateInfo: any) => Promise<{
          success: boolean
          error?: string
        }>

        // 指令管理
        getCommands: () => Promise<{
          commands: any[]
          regexCommands: any[]
        }>

        // 本地启动管理
        localShortcuts: {
          getAll: () => Promise<
            Array<{
              id: string
              name: string
              path: string
              type: 'file' | 'folder' | 'app'
              icon?: string
              keywords?: string[]
              pinyin?: string
              pinyinAbbr?: string
              addedAt: number
            }>
          >
          add: (type: 'file' | 'folder') => Promise<{ success: boolean; error?: string }>
          addByPath: (filePath: string) => Promise<{ success: boolean; error?: string }>
          delete: (id: string) => Promise<{ success: boolean; error?: string }>
          open: (path: string) => Promise<{ success: boolean; error?: string }>
        }

        // 图片分析
        analyzeImage: (imagePath: string) => Promise<{
          isSimpleIcon: boolean
          mainColor: string | null
          isDark: boolean
          needsAdaptation: boolean
        }>

        // WebDAV 同步
        syncGetConfig: () => Promise<{
          success: boolean
          config?: {
            enabled: boolean
            serverUrl: string
            username: string
            password: string
            syncInterval: number
            lastSyncTime: number
          }
          error?: string
        }>
        syncGetUnsyncedCount: () => Promise<{
          success: boolean
          count?: number
          error?: string
        }>
        syncStopAutoSync: () => Promise<{
          success: boolean
          error?: string
        }>
        syncTestConnection: (config: {
          serverUrl: string
          username: string
          password: string
        }) => Promise<{
          success: boolean
          error?: string
        }>
        syncSaveConfig: (config: {
          enabled: boolean
          serverUrl: string
          username: string
          password: string
          syncInterval: number
        }) => Promise<{
          success: boolean
          error?: string
        }>
        syncPerformSync: () => Promise<{
          success: boolean
          result?: {
            uploaded: number
            downloaded: number
            errors: number
          }
          error?: string
        }>
        syncForceDownloadFromCloud: () => Promise<{
          success: boolean
          result?: {
            downloaded: number
            errors: number
          }
          error?: string
        }>
      }
    }
  }
}

export {}
